<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Monitoramento de Yield</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <header>
    <img src="https://img.icons8.com/color/48/000000/pie-chart--v1.png" alt="Logo" width="40"/>
    <h1>Parcial da Acer '</h1>
  </header>

  <div class="sidebar">
    <button onclick="reloadDashboard()">Atualizar Agora</button>
    <button onclick="abrirRegistro()">Registrar Ação</button>
    <div class="countdown">Atualização em: <span id="timer">60</span> segundos</div>
  </div>

  <div class="content">
    <iframe
      id="powerbi-frame"
      src="https://app.powerbi.com/view?r=eyJrIjoiZDk1MzA4OGEtZmQ5MS00ZTUzLTkyMDctMGIzY2U1MjEyMjc4IiwidCI6IjhlYzJhYWMxLTgwNWItNDA2OS04NDFjLTUyN2I0YWQ3MjFkMSJ9&pageName=f70603e69432f4233f0e"
      allowfullscreen="true">
    </iframe>

    <div id="formulario" style="display:none; margin-top: 20px; background:#f8f7f7; padding:20px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.1); position: relative;">
        <button onclick="fecharFormulario()" style="position:absolute; top:10px; right:10px; background:#e74c3c; color:#fff; border:none; border-radius:50%; width:30px; height:30px; cursor:pointer;">X</button>
        <h3>Registrar Ação</h3>
        <input type="text" id="Componente" placeholder="Componente"><br><br>
        <input type="text" id="Modelo" placeholder="Modelo"><br><br>
        <input type="text" id="Acoes" placeholder="Ações"><br><br>
        <input type="text" id="Responsavel" placeholder="Responsável"><br><br>
        <button onclick="salvarAcao()">Salvar</button>
    </div>

    <div id="resultado" style="margin-top: 10px;"></div>
  </div>

  <script>
    // Substitua pela sua URL do Google Apps Script
    const scriptURL = "https://script.google.com/macros/s/SEU_ID_AQUI/exec";

    function abrirRegistro() {
      document.getElementById("formulario").style.display = "block";
    }

    function fecharFormulario() {
      document.getElementById("formulario").style.display = "none";
    }

    function salvarAcao() {
      const componente = document.getElementById("Componente").value;
      const modelo = document.getElementById("Modelo").value;
      const acoes = document.getElementById("Acoes").value;
      const responsavel = document.getElementById("Responsavel").value;

      if (!componente || !modelo || !acoes || !responsavel) {
        document.getElementById("resultado").textContent = "Por favor, preencha todos os campos.";
        return;
      }

      fetch(scriptURL, {
        method: 'POST',
        body: JSON.stringify({
          componente: componente,
          modelo: modelo,
          acoes: acoes,
          responsavel: responsavel
        }),
        headers: { 'Content-Type': 'application/json' }
      })
      .then(response => {
        document.getElementById("resultado").textContent = "Ação registrada com sucesso!";
        document.getElementById("formulario").style.display = "none";
        document.getElementById("Componente").value = "";
        document.getElementById("Modelo").value = "";
        document.getElementById("Acoes").value = "";
        document.getElementById("Responsavel").value = "";
      })
      .catch(error => {
        document.getElementById("resultado").textContent = "Erro ao enviar os dados.";
        console.error("Erro:", error);
      });
    }

    // Simulação da função de atualização automática (você pode personalizar)
    function reloadDashboard() {
      document.getElementById("powerbi-frame").src += "";
    }

    // Temporizador de atualização
    let tempo = 60;
    setInterval(() => {
      tempo--;
      document.getElementById("timer").textContent = tempo;
      if (tempo === 0) {
        reloadDashboard();
        tempo = 60;
      }
    }, 1000);
  </script>

</body>
</html>
